<UserControl x:Class="GGHardware.Views.Backup"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900">

    <Grid Background="{DynamicResource MaterialDesignPaper}">
        <!-- Scroll vertical y horizontal automatico -->
        <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
            <Border Padding="20" MinWidth="800">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Titulo -->
                    <TextBlock Text="Gestion de Backup y Restauracion"
                               FontSize="24" FontWeight="Bold"
                               Foreground="{DynamicResource MaterialDesignBody}"
                               Margin="0 0 0 20"/>

                    <!-- Seccion de Backup -->
                    <Border Grid.Row="1" BorderBrush="{DynamicResource MaterialDesignDivider}" 
                            BorderThickness="1" CornerRadius="8" Padding="20" Margin="0 0 0 20"
                            Background="{DynamicResource MaterialDesignCardBackground}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="200"/>
                            </Grid.RowDefinitions>

                            <TextBlock Text="Realizar Backup"
                                       FontSize="18" FontWeight="Bold"
                                       Foreground="{DynamicResource MaterialDesignBody}"
                                       Margin="0 0 0 15"/>

                            <!-- Selector de Instancia -->
                            <StackPanel Grid.Row="1" Margin="0 0 0 15">
                                <TextBlock Text="Instancia de SQL Server:" FontWeight="SemiBold" Margin="0 0 0 5"/>
                                <ComboBox x:Name="cmbInstancia" MaxWidth="350" HorizontalAlignment="Left"
                                         materialDesign:HintAssist.Hint="Seleccione la instancia"
                                         Height="40" Padding="10"
                                         SelectionChanged="cmbInstancia_SelectionChanged"/>
                            </StackPanel>

                            <!-- Selector de Base de Datos -->
                            <StackPanel Grid.Row="2" Margin="0 0 0 15">
                                <TextBlock Text="Base de Datos:" FontWeight="SemiBold" Margin="0 0 0 5"/>
                                <ComboBox x:Name="cmbBaseDatos" MaxWidth="350" HorizontalAlignment="Left"
                                         materialDesign:HintAssist.Hint="Seleccione la base de datos"
                                         Height="40" Padding="10"/>
                            </StackPanel>

                            <!-- Ruta del Backup -->
                            <Grid Grid.Row="3" Margin="0 0 0 15">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" MaxWidth="350"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox x:Name="txtRuta" Grid.Column="0" Margin="0 0 10 0" IsReadOnly="True"
                                         materialDesign:HintAssist.Hint="Seleccione una ubicacion para guardar"
                                         Height="40" Padding="10"/>
                                <Button x:Name="btnSeleccionarRuta" Grid.Column="1" Content="Buscar..." Width="100" Height="40"
                                        Style="{DynamicResource MaterialDesignRaisedButton}" 
                                        Click="btnSeleccionarRuta_Click"/>
                            </Grid>

                            <!-- Boton de Backup -->
                            <Button x:Name="btnBackup" Grid.Row="4" Content="Realizar Backup" Width="150" Height="40"
                                    Style="{DynamicResource MaterialDesignRaisedButton}" FontWeight="Bold"
                                    Click="btnBackup_Click" Margin="0 0 0 15" HorizontalAlignment="Left"
                                    Background="#2196F3" Foreground="White"/>

                            <!-- Estado del Backup -->
                            <TextBlock x:Name="lblEstado" Grid.Row="5"
                                       FontSize="14" Foreground="{DynamicResource MaterialDesignBody}"
                                       TextWrapping="Wrap" Margin="0 0 0 15"/>

                            <!-- DataGrid para historial con scroll -->
                            <Border Grid.Row="6" BorderBrush="{DynamicResource MaterialDesignDivider}" 
                                    BorderThickness="1">
                                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                                    <DataGrid x:Name="dgBackups" AutoGenerateColumns="False" IsReadOnly="True" 
                                              SelectionMode="Single" MinWidth="600">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="ID" Binding="{Binding id}" Width="50"/>
                                            <DataGridTextColumn Header="Archivo" Binding="{Binding NombreArchivo}" Width="200"/>
                                            <DataGridTextColumn Header="Fecha" Binding="{Binding Fecha, StringFormat=dd/MM/yyyy HH:mm}" Width="150"/>
                                            <DataGridTextColumn Header="Ruta" Binding="{Binding RutaArchivo}" Width="*" MinWidth="200"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </ScrollViewer>
                            </Border>
                        </Grid>
                    </Border>

                    <!-- Seccion de Solicitudes de Restauracion (Gerente) -->
                    <Border Grid.Row="2" BorderBrush="{DynamicResource MaterialDesignDivider}" 
                            BorderThickness="1" CornerRadius="8" Padding="20"
                            Background="{DynamicResource MaterialDesignCardBackground}"
                            Margin="0 0 0 10" MaxWidth="1100" >
                        <StackPanel>
                            <TextBlock Text="Solicitudes de Restauracion Pendientes"
                                       FontSize="18" FontWeight="Bold"
                                       Foreground="{DynamicResource MaterialDesignBody}"
                                       Margin="0 0 0 15"/>

                            <ScrollViewer VerticalScrollBarVisibility="Auto"
                                          HorizontalScrollBarVisibility="Disabled"
                                          MaxHeight="250">
                                <DataGrid x:Name="dgSolicitudesPendientes"
                                          AutoGenerateColumns="False"
                                          SelectionMode="Single"
                                          IsReadOnly="True"
                                          MouseDoubleClick="dgSolicitudesPendientes_MouseDoubleClick"
                                          HeadersVisibility="Column"
                                          CanUserAddRows="False">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="ID" Binding="{Binding id_solicitud}" Width="Auto"/>
                                        <DataGridTextColumn Header="Supervisor" Binding="{Binding nombre_supervisor}" Width="150"/>
                                        <DataGridTextColumn Header="Fecha Solicitud" Binding="{Binding fecha_solicitud, StringFormat=dd/MM/yyyy HH:mm}" Width="150"/>
                                        <DataGridTextColumn Header="Estado" Binding="{Binding estado}" Width="100"/>

                                        <DataGridTemplateColumn Header="Acciones" Width="350">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Button Content="Detalles"
                                                                Click="DetallesSolicitud_Click"
                                                                Margin="0 5 5 0"
                                                                Padding="10,5"
                                                                Background="#2196F3"
                                                                Foreground="White"
                                                                FontSize="11"/>
                                                        <Button Content="Aprobar"
                                                                Click="AprobarSolicitud_Click"
                                                                Margin="0 5 5 0"
                                                                Padding="10,5"
                                                                Background="#4CAF50"
                                                                Foreground="White"
                                                                FontSize="11"/>
                                                        <Button Content="Rechazar"
                                                                Click="RechazarSolicitud_Click"
                                                                Padding="10,5"
                                                                Background="#F44336"
                                                                Foreground="White"
                                                                FontSize="11"/>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
        </ScrollViewer>
    </Grid>
</UserControl>
